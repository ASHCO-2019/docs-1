<!DOCTYPE html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=description content=""><meta name=author content=""><link rel=stylesheet href=css/doc.css><title>how to write a loader</title><body><script src=js/doc.js charset=utf-8 async></script><div class=container><div class=row><div class=col-md-3><div class=logo><ul class=cube-inner><li class=front></li><li class=back></li><li class=right></li><li class=left></li><li class=top></li><li class=bottom></li></ul><ul class=cube><li class=front></li><li class=back></li><li class=right></li><li class=left></li><li class=top></li><li class=bottom></li><li class=floor></li></ul></div><div class=name>webpack</div><div class=tagline>MODULE BUNDLER</div><div class=sidebar><p><a href=.>Home</a></p><ul><li>Getting Started<ul><li><a href=motivation.html>Motivation</a></li><li><a href=what-is-webpack.html>What is webpack?</a></li><li><a href=installation.html>Installation</a> (WIP)</li><li><a href=usage.html>Usage</a> (WIP)</li><li>Require Modules (WIP)</li><li>Vendor Modules (WIP)</li><li><a href=using-loaders.html>Using Loaders</a></li><li>Dev Tools (WIP)</li></ul></li><li>Step-by-step tutorials<ul><li><a href="http://webpack.github.io/docs/tutorials/getting-started/">Getting started</a></li></ul></li><li>Guides<ul><li><a href=commonjs.html>CommonJs</a></li><li><a href=amd.html>AMD</a></li><li><a href=usage-with-grunt.html>Usage with Grunt</a></li><li><a href=usage-with-gulp.html>Usage with gulp</a></li><li><a href=webpack-for-browserify-users.html>webpack for browserify users</a></li><li><a href=code-splitting.html>Code Splitting</a></li><li><a href=optimization.html>Optimization</a></li><li><a href=long-time-caching.html>Long-time Caching</a></li><li><a href=how-to-write-a-loader.html>How to write a loader</a></li><li>How to write a plugin (WIP)</li><li><a href=shimming-modules.html>Shimming modules</a></li><li><a href=testing.html>Testing</a></li><li><a href=comparison.html>Comparison</a></li></ul></li><li>Lists<ul><li><a href=list-of-loaders.html>List of loaders</a></li><li><a href=list-of-plugins.html>List of plugins</a></li></ul></li><li>API<ul><li><a href=configuration.html>Configuration</a></li><li><a href=cli.html>CLI</a></li><li><a href=node.js-api.html>Node.js API</a></li><li><a href=api-in-modules.html>API in modules</a></li><li><a href=loaders.html>Loaders</a></li><li><a href=plugins.html>Plugins</a></li><li><a href=context.html>Context</a></li><li><a href=resolving.html>Resolving</a></li><li><a href=hot-module-replacement.html>Hot Module Replacement</a></li><li>Dev Tools<ul><li><a href=webpack-dev-server.html>webpack-dev-server</a></li><li><a href=webpack-dev-middleware.html>webpack-dev-middleware</a></li></ul></li></ul></li><li>Development<ul><li><a href=changelog.html>Changelog</a></li><li><a href=roadmap.html>Roadmap</a></li><li><a href=ideas.html>Ideas</a></li><li>Contributing (WIP)</li></ul></li></ul></div></div><div class=col-md-9><div class=pull-right><a href=https://github.com/webpack/docs/wiki/how-to-write-a-loader/_edit id=wikieditlink>Edit</a></div><div class=row><div class=col-md-12><div class=page-header><h1 id=wikititle>how to write a loader</h1></div></div></div><div class=row><div id=wiki class=col-md-12><div class=contents><ul><li><a href=#examples>Examples</a></li><li><a href=#guidelines>Guidelines</a><ul><li><a href=#do-only-a-single-task>do only a single task</a></li><li><a href=#flag-itself-cachable-if-possible>flag itself cachable if possible</a></li><li><a href=#mark-dependencies>mark dependencies</a></li></ul></li><li><a href=#read-more>Read more</a></li></ul></div><p>A loader is a node module exporting a <code><span class=function><span class=keyword>function</span></span></code>.</p><p>This function is called when a resource should be transformed by this loader.</p><p>In the simple case, when only a single loader is applied to the resource, the loader is called with one parameter: the content of the resource file as string.</p><p>The loader can access the <a href=loaders.html>loader API</a> on the <code><span class=keyword>this</span></code> context in the function.</p><p>A sync loader that only want to give a one value can simply <code><span class=keyword>return</span></code> it. In every other case the loader can give back any number of values with the <code><span class=keyword>this</span>.callback(err, values...)</code> function. Errors are passed to the <code><span class=keyword>this</span>.callback</code> function or throwed in a sync loader.</p><p>The loader is expected to give back one or two values. The first value is a resulting javascript code as string or buffer. The second optional value is a SourceMap as javascript object.</p><p>In the complex case, when multiple loaders are chained, only the last loader gets the resource file and only the first loader is expected to give back one or two values (javascript and SourceMap). Values that any other loader give back are passed to the previous loader.</p><h2 id=examples><a class=anchor href=#examples>&rarr;</a>Examples</h2><pre><code><span class=comment>// Identity loader</span>
module.exports = <span class=function><span class=keyword>function</span><span class=params>(source)</span> {</span>
  <span class=keyword>return</span> source;
};</code></pre><pre><code><span class=comment>// Identity loader with SourceMap support</span>
module.exports = <span class=function><span class=keyword>function</span><span class=params>(source, map)</span> {</span>
  <span class=keyword>this</span>.callback(<span class=literal>null</span>, source, map);
};</code></pre><h2 id=guidelines><a class=anchor href=#guidelines>&rarr;</a>Guidelines</h2><p>Loaders should</p><h3 id=do-only-a-single-task><a class=anchor href=#do-only-a-single-task>&rarr;</a>do only a single task</h3><p>Loaders can be chained. Create loaders for every step, instead of a loader that does everything at once.</p><p>This also means they should not convert to javascript if not necessary.</p><p>Example: Render HTML from a template file by applying the query parameters</p><p>I could write a loader that compiles the template from source, execute it and return a module that exports a string containing the HTML code. This is bad.</p><p>Instead I should write loaders for every task in this usecase and apply them all (pipeline):</p><ul><li>jade-loader: Convert template to a module that exports a function.</li><li>apply-loader: Takes a function exporting module and returns raw result by applying query parameters.</li><li>html-loader: Takes HTML and exports a string exporting module.</li></ul><h3 id=flag-itself-cachable-if-possible><a class=anchor href=#flag-itself-cachable-if-possible>&rarr;</a>flag itself cachable if possible</h3><p>Most loaders are cachable, so they should flag itself as cachable.</p><p>Just call <code>cachable</code> in the loader.</p><pre><code><span class=comment>// Cachable identity loader</span>
module.exports = <span class=function><span class=keyword>function</span><span class=params>(source)</span> {</span>
  <span class=keyword>this</span>.cachable();
  <span class=keyword>return</span> source;
};</code></pre><h3 id=mark-dependencies><a class=anchor href=#mark-dependencies>&rarr;</a>mark dependencies</h3><p>If a loader uses external resources, they <strong>must</strong> tell about that. This information is used to invalidate cachable loaders and recompile in watch mode.</p><pre><code><span class=comment>// Loader adding a header</span>
<span class=keyword>var</span> path = require(<span class=string>"path"</span>);
module.exports = <span class=function><span class=keyword>function</span><span class=params>(source)</span> {</span>
  <span class=keyword>this</span>.cachable();
  <span class=keyword>var</span> callback = <span class=keyword>this</span>.async();
  <span class=keyword>var</span> headerPath = path.resolve(<span class=string>"header.js"</span>);
  <span class=keyword>this</span>.dependency(headerPath);
  fs.readFile(headerPath, <span class=string>"utf-8"</span>, <span class=function><span class=keyword>function</span><span class=params>(err, header)</span> {</span>
    <span class=keyword>if</span>(err) <span class=keyword>return</span> callback(err);
    callback(<span class=literal>null</span>, header + <span class=string>"\n"</span> + source);
  });
};</code></pre><h2 id=read-more><a class=anchor href=#read-more>&rarr;</a>Read more</h2><p>Read more about <a href=loaders.html>loaders</a>.</p></div></div></div></div></div><a href=https://github.com/webpack/webpack><img style="position: absolute; top: 0; left: 0; border: 0" src=https://s3.amazonaws.com/github/ribbons/forkme_left_orange_ff7600.png alt="Fork me on GitHub"></a>