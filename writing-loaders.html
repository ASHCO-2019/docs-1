<!DOCTYPE html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=description content=""><meta name=author content=""><title>writing loaders</title><body><div class=container><div class=row><div class=col-md-3><div class=logo><ul class=cube-inner><li class=front></li><li class=back></li><li class=right></li><li class=left></li><li class=top></li><li class=bottom></li></ul><ul class=cube><li class=front></li><li class=back></li><li class=right></li><li class=left></li><li class=top></li><li class=bottom></li><li class=floor></li></ul><div class=name>webpack</div><div class=tagline>MODULE BUNDLER</div></div><div id=sidebar class=sidebar><p><a href=home.html>Home</a></p><h1>webpack</h1><ul><li><a href=webpack-getting-started.html>webpack Getting Started</a></li><li>Basic<ul><li><a href=commonjs.html>CommonJS</a></li><li><a href=amd.html>AMD</a></li><li><a href=webpack-usage.html>webpack usage</a><ul><li><a href=webpack-detailed-usage.html>webpack detailed usage</a></li><li><a href=webpack-options.html>webpack options</a></li><li><a href=https://github.com/webpack/grunt-webpack>webpack with grunt</a></li><li><a href=webpack-plugins.html>webpack plugins</a></li></ul></li><li><a href=chunks.html>chunks</a></li><li><a href=resolving.html>resolving</a></li><li><a href=loaders.html>loaders</a></li><li><a href=loader-list.html>loader list</a></li><li><a href=require.context.html>require.context</a></li><li><a href=require.ensure.html>require.ensure</a></li><li><a href=webpack-dev-tools.html>webpack dev tools</a><ul><li><a href=webpack-dev-server.html>webpack-dev-server</a></li><li><a href=webpack-dev-middleware.html>webpack-dev-middleware</a></li></ul></li><li><a href=webpack-comparison.html>webpack comparison</a></li></ul></li><li>Advanced<ul><li><a href=writing-loaders.html>writing loaders</a></li><li><a href=require.include.html>require.include</a></li><li><a href=writing-webpack-plugins.html>writing webpack plugins</a></li><li><a href=optimizing.html>optimizing</a></li><li><a href=hot-module-replacement.html>Hot Module Replacement</a></li><li><a href=hot-module-replacement-with-webpack.html>Hot Module Replacement with webpack</a></li><li><a href=webpack-runtime-api-summary.html>webpack runtime api summary</a></li></ul></li></ul><h1>enhanced-require</h1><p>Coming soon…</p></div></div><div class=col-md-9><div class=pull-right><a href=https://github.com/webpack/docs/wiki/writing-loaders/_edit id=wikieditlink>Edit</a></div><div class=row><div class=col-md-12><div class=page-header><h1 id=wikititle>writing loaders</h1></div></div></div><div class=row><div id=wiki class=col-md-12><p>Writing a loader is pretty simple. A loader is just a file, which exports a function. That function is called by the compiler. The result of the previous loader is passed to the next loader. The <code><span class=keyword>this</span></code> context is filled by the compiler with some useful methods. I. e. loaders can change there invocation style to async or get query parameters. The first loader is passed one argument: the content of the resource file. The compiler expect a result from the last loader. The first result should be a String or a Buffer (which is converted to a string), representing the javascript source code of the module. As additional optional second result is a SourceMap (as JSON object) expected.</p><p>A single result can be returned in sync mode. For multiple result the <code><span class=keyword>this</span>.callback</code> must be called. In async mode <code><span class=keyword>this</span>.async()</code> must be called. It returns <code><span class=keyword>this</span>.callback</code> if async mode is allowed. Then the loader must return <code><span class=literal>undefined</span></code> and call the callback.</p><p>Errors can be thrown in sync mode or the <code><span class=keyword>this</span>.callback</code> can be called with the error.</p><p>webpack allows async mode in every case.</p><p>enhanced-require allows async mode only with <code>require.ensure</code> or AMD <code>require</code>.</p><h2><a class=anchor href=#examples id=examples><i class="glyphicon glyphicon-link"></i></a>examples</h2><h3><a class=anchor href=#sync-loader id=sync-loader><i class="glyphicon glyphicon-link"></i></a>sync loader</h3><pre><code>module.exports = <span class=function><span class=keyword>function</span><span class=params>(content)</span> {</span>
  <span class=keyword>return</span> someSyncOperation(content);
};</code></pre><h3><a class=anchor href=#async-loader id=async-loader><i class="glyphicon glyphicon-link"></i></a>async loader</h3><pre><code>module.exports = <span class=function><span class=keyword>function</span><span class=params>(content)</span> {</span>
  <span class=keyword>var</span> callback = <span class=keyword>this</span>.async();
  <span class=keyword>if</span>(!callback) <span class=keyword>return</span> someSyncOperation(content);
  someAsyncOperation(content, <span class=function><span class=keyword>function</span><span class=params>(err, result)</span> {</span>
    <span class=keyword>if</span>(err) <span class=keyword>return</span> callback(err);
    callback(<span class=literal>null</span>, result);
  });
};</code></pre><h3><a class=anchor href=#raw-loader id=raw-loader><i class="glyphicon glyphicon-link"></i></a>raw loader</h3><p>By default the resource file is threaded as <code>utf-<span class=number>8</span></code> string and passed as String to the loader. By setting <code>raw</code> to <code><span class=literal>true</span></code> the loader is passed the raw Buffer.</p><p>Every loader is allowed to deliver its result as String or as Buffer. The compiler converts them between loaders.</p><pre><code>module.exports = <span class=function><span class=keyword>function</span><span class=params>(content)</span> {</span>
  assert(content <span class=keyword>instanceof</span> Buffer);
  <span class=keyword>return</span> someSyncOperation(content);
  <span class=comment>// return value can be a Buffer too</span>
  <span class=comment>// This is also allowed if loader is not "raw"</span>
};
module.exports.raw = <span class=literal>true</span>;</code></pre><h3><a class=anchor href=#pitching-loader id=pitching-loader><i class="glyphicon glyphicon-link"></i></a>pitching loader</h3><p>The loaders are called from right to left. But in some cases loaders doesn’t care for the results of the previous loader or the resource. They only care for metadata. The <code>pitch</code> method on the loaders is called from left to right before the loaders are called. If a loader delivers a result in the pitch method the process turns around and skips the remaining loaders, continuing with the calls to the more left loaders. <code>data</code> can be passed between pitch and normal call.</p><pre><code>module.exports = <span class=function><span class=keyword>function</span><span class=params>(content)</span> {</span>
  <span class=keyword>return</span> someSyncOperation(content, <span class=keyword>this</span>.data.value);
};
module.exports.pitch = <span class=function><span class=keyword>function</span><span class=params>(remainingRequest, precedingRequest, data)</span> {</span>
  <span class=keyword>if</span>(someCondition()) {
    <span class=comment>// fast exit</span>
    <span class=keyword>return</span> <span class=string>"module.exports = require("</span> + JSON.stringify(<span class=string>"-!"</span> + remainingRequest) + <span class=string>");"</span>;
  }
  data.value = <span class=number>42</span>;
};</code></pre><h2><a class=anchor href=#loader-context id=loader-context><i class="glyphicon glyphicon-link"></i></a>loader context</h2><p>This stuff is available on <code><span class=keyword>this</span></code> in a loader.</p><p>For the example this require call is used:</p><p>In <code>/abc/file.js</code>:</p><pre><code>require(<span class=string>"./loader1?xyz!loader2!./resource?rrr"</span>);</code></pre><h3><a class=anchor href=#version-1 id=version-1><i class="glyphicon glyphicon-link"></i></a><code>version = <span class=number>1</span></code></h3><p>Loader API version.</p><h3><a class=anchor href=#context-string id=context-string><i class="glyphicon glyphicon-link"></i></a><code>context: string</code></h3><p>The directory of the module. Can be used as context for resolving other stuff.</p><p>In the example: <code>/abc</code> because <code>resource.js</code> is in this directory</p><h3><a class=anchor href=#request-string id=request-string><i class="glyphicon glyphicon-link"></i></a><code>request: string</code></h3><p>The resolved request string.</p><p>In the example: <code><span class=string>"/abc/loader1.js?xyz!/abc/node_modules/loader2/index.js!/abc/resource.js?rrr"</span></code></p><h3><a class=anchor href=#query-string id=query-string><i class="glyphicon glyphicon-link"></i></a><code>query: string</code></h3><p>The query of the request for the current loader.</p><p>In the example: in loader1: <code><span class=string>"?xyz"</span></code>, in loader2: <code><span class=string>""</span></code></p><h3><a class=anchor href=#data-object id=data-object><i class="glyphicon glyphicon-link"></i></a><code>data: Object</code></h3><p>A data object shared between the pitch and the normal phase.</p><h3><a class=anchor href=#cacheable-function-flag-true-boolean id=cacheable-function-flag-true-boolean><i class="glyphicon glyphicon-link"></i></a><code>cacheable: <span class=function><span class=keyword>function</span><span class=params>(flag = true: boolean)</span></span></code></h3><p>Make this loader result cacheable. By default it’s not cacheable.</p><h3><a class=anchor href=#loaders-request-string-path-string-query-string-module-function id=loaders-request-string-path-string-query-string-module-function><i class="glyphicon glyphicon-link"></i></a><code>loaders: {request: string, path: string, query: string, module: function}[]</code></h3><p>An array of all the loaders. It is writeable in the pitch phase.</p><p>In the example:</p><pre><code>[
  { request: <span class=string>"/abc/loader1.js?xyz"</span>,
    path: <span class=string>"/abc/loader1.js"</span>,
    query: <span class=string>"?xyz"</span>,
    module: [Function]
  },
  { request: <span class=string>"/abc/node_modules/loader2/index.js"</span>,
    path: <span class=string>"/abc/node_modules/loader2/index.js"</span>,
    query: <span class=string>""</span>,
    module: [Function]
  }
]</code></pre><h3><a class=anchor href=#loaderindex-number id=loaderindex-number><i class="glyphicon glyphicon-link"></i></a><code>loaderIndex: number</code></h3><p>The index in the loaders array of the current loader.</p><p>In the example: in loader1: <code><span class=number>0</span></code>, in loader2: <code><span class=number>1</span></code></p><h3><a class=anchor href=#resource-string id=resource-string><i class="glyphicon glyphicon-link"></i></a><code>resource: string</code></h3><p>The resource part of the request, including query.</p><p>In the example: <code><span class=string>"/abc/resource.js?rrr"</span></code></p><h3><a class=anchor href=#resourcepath-string id=resourcepath-string><i class="glyphicon glyphicon-link"></i></a><code>resourcePath: string</code></h3><p>The resource file.</p><p>In the example: <code><span class=string>"/abc/resource.js"</span></code></p><h3><a class=anchor href=#resourcequery-string id=resourcequery-string><i class="glyphicon glyphicon-link"></i></a><code>resourceQuery: string</code></h3><p>The query of the resource.</p><p>In the example: <code><span class=string>"?rrr"</span></code></p><h3><a class=anchor href=#emitwarning-function-message-string id=emitwarning-function-message-string><i class="glyphicon glyphicon-link"></i></a><code>emitWarning: <span class=function><span class=keyword>function</span><span class=params>(message: string)</span></span></code></h3><p>Emit a warning.</p><h3><a class=anchor href=#emiterror-function-message-string id=emiterror-function-message-string><i class="glyphicon glyphicon-link"></i></a><code>emitError: <span class=function><span class=keyword>function</span><span class=params>(message: string)</span></span></code></h3><p>Emit an error.</p><h3><a class=anchor href=#exec-function-code-string-filename-string id=exec-function-code-string-filename-string><i class="glyphicon glyphicon-link"></i></a><code>exec: <span class=function><span class=keyword>function</span><span class=params>(code: string, filename: string)</span></span></code></h3><p>Execute some code fragment like a module.</p><h3><a class=anchor href=#resolve-function-context-string-request-string-callback-function-err-result-string id=resolve-function-context-string-request-string-callback-function-err-result-string><i class="glyphicon glyphicon-link"></i></a><code>resolve: function(context: string, request: string, callback: function(err, result: string))</code></h3><p>Resolve a request like a require expression.</p><h3><a class=anchor href=#resolvesync-function-context-string-request-string-string id=resolvesync-function-context-string-request-string-string><i class="glyphicon glyphicon-link"></i></a><code>resolveSync: <span class=function><span class=keyword>function</span><span class=params>(context: string, request: string)</span> -&gt; <span class=title>string</span></span></code></h3><p>Resolve a request like a require expression.</p><h3><a class=anchor href=#adddependency-function-file-string id=adddependency-function-file-string><i class="glyphicon glyphicon-link"></i></a><code>addDependency: <span class=function><span class=keyword>function</span><span class=params>(file: string)</span></span></code></h3><p>Add a file as dependency of the loader result.</p><h3><a class=anchor href=#addcontextdependency-function-directory-string id=addcontextdependency-function-directory-string><i class="glyphicon glyphicon-link"></i></a><code>addContextDependency: <span class=function><span class=keyword>function</span><span class=params>(directory: string)</span></span></code></h3><p>Add a directory as dependency of the loader result.</p><h3><a class=anchor href=#cleardependencies-function id=cleardependencies-function><i class="glyphicon glyphicon-link"></i></a><code>clearDependencies: <span class=function><span class=keyword>function</span><span class=params>()</span></span></code></h3><p>Remove all dependencies of the loader result. Even initial dependencies and these of other loaders. Consider using <code>pitch</code>.</p><h3><a class=anchor href=#values-any-out id=values-any-out><i class="glyphicon glyphicon-link"></i></a><code>values: any</code> (out)</h3><p>Pass values to the next loaders <code>inputValues</code>. If you know what your result exports if executed as module, set this value here (as a only element array).</p><h3><a class=anchor href=#inputvalues-any id=inputvalues-any><i class="glyphicon glyphicon-link"></i></a><code>inputValues: any</code></h3><p>Passed from the last loader. If you would execute the input argument as module, consider reading this variable for a shortcut (for performance).</p><h3><a class=anchor href=#options id=options><i class="glyphicon glyphicon-link"></i></a><code>options: {...}</code></h3><p>The options passed to the Compiler.</p><h3><a class=anchor href=#debug-boolean id=debug-boolean><i class="glyphicon glyphicon-link"></i></a><code>debug: boolean</code></h3><p>In debug mode</p><h3><a class=anchor href=#minimize-boolean-webpack id=minimize-boolean-webpack><i class="glyphicon glyphicon-link"></i></a><code>minimize: boolean</code> (webpack)</h3><p>Should the result be minimized.</p><h3><a class=anchor href=#webpack-true-webpack id=webpack-true-webpack><i class="glyphicon glyphicon-link"></i></a><code>webpack = <span class=literal>true</span></code> (webpack)</h3><p>Is this compiled by webpack.</p><h3><a class=anchor href=#emitfile-function-name-string-content-buffer-string-sourcemap-webpack id=emitfile-function-name-string-content-buffer-string-sourcemap-webpack><i class="glyphicon glyphicon-link"></i></a><code>emitFile: <span class=function><span class=keyword>function</span><span class=params>(name: string, content: Buffer|String, sourceMap: {...})</span></span></code> (webpack)</h3><p>Emit a file.</p><h3><a class=anchor href=#_compilation-compilation-webpack id=_compilation-compilation-webpack><i class="glyphicon glyphicon-link"></i></a><code>_compilation: Compilation</code> (webpack)</h3><p>Hacky access to the Compilation object of webpack.</p><h3><a class=anchor href=#_compiler-compiler-webpack id=_compiler-compiler-webpack><i class="glyphicon glyphicon-link"></i></a><code>_compiler: Compiler</code> (webpack)</h3><p>Hacky access to the Compiler object of webpack.</p></div></div></div></div></div><a href=https://github.com/webpack/webpack><img style="position: absolute; top: 0; left: 0; border: 0" src=https://s3.amazonaws.com/github/ribbons/forkme_left_orange_ff7600.png alt="Fork me on GitHub"></a><script src=js/doc.js charset=utf-8></script>