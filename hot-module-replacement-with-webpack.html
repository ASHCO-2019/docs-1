<!DOCTYPE html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content=""><meta name=author content=""><link rel=icon type=image/png href=/assets/favicon.png><link rel=stylesheet href=css/doc.css><title>hot module replacement with webpack</title><body><script src=js/doc.js charset=utf-8 async></script><div class=container><div class=row><div class="col-md-3 nav"><div class=logo><ul class=cube-inner><li class=front></li><li class=back></li><li class=right></li><li class=left></li><li class=top></li><li class=bottom></li></ul><ul class=cube><li class=front></li><li class=back></li><li class=right></li><li class=left></li><li class=top></li><li class=bottom></li><li class=floor></li></ul></div><div class=name>webpack</div><div class=tagline>MODULE BUNDLER</div><div class=sidebar><ul><li><a href=.>Home</a></li></ul><ul><li>Getting Started<ul><li><a href=motivation.html>Motivation</a></li><li><a href=what-is-webpack.html>What is webpack?</a></li><li><a href=installation.html>Installation</a></li><li><a href=usage.html>Usage</a></li><li>Require Modules</li><li>Vendor Modules</li><li><a href=using-loaders.html>Using Loaders</a></li><li><a href=using-plugins.html>Using Plugins</a></li><li><a href=dev-tools.html>Dev Tools</a></li></ul></li><li>tutorials and examples<ul><li><a href="http://webpack.github.io/docs/tutorials/getting-started/">Getting started</a></li><li><a href=list-of-tutorials.html>List of tutorials</a></li><li><a href=examples.html>examples</a></li></ul></li><li>Guides<ul><li><a href=commonjs.html>CommonJs</a></li><li><a href=amd.html>AMD</a></li><li><a href=webpack-for-browserify-users.html>webpack for browserify users</a></li><li><a href=code-splitting.html>Code Splitting</a></li><li><a href=stylesheets.html>Stylesheets</a></li><li><a href=optimization.html>Optimization</a></li><li><a href=long-term-caching.html>Long-term Caching</a></li><li><a href=how-to-write-a-loader.html>How to write a loader</a></li><li>How to write a plugin</li><li><a href=multiple-entry-points.html>Multiple entry points</a></li><li><a href=library-and-externals.html>Library and externals</a></li><li><a href=shimming-modules.html>Shimming modules</a></li><li><a href=testing.html>Testing</a></li><li><a href=build-performance.html>Build performance</a></li><li><a href=hot-module-replacement-with-webpack.html>Hot Module Replacement with webpack</a></li><li><a href=comparison.html>Comparison</a></li></ul></li><li>webpack with<ul><li><a href=usage-with-grunt.html>grunt</a></li><li><a href=usage-with-gulp.html>gulp</a></li><li><a href=usage-with-bower.html>bower</a></li><li><a href=usage-with-karma.html>karma</a></li></ul></li><li>Lists<ul><li><a href=loader-conventions.html>loader conventions</a></li><li><a href=list-of-loaders.html>List of loaders</a></li><li><a href=list-of-plugins.html>List of plugins</a></li><li><a href=list-of-tutorials.html>List of tutorials</a></li></ul></li><li>API<ul><li><a href=configuration.html>Configuration</a></li><li><a href=cli.html>CLI</a></li><li><a href=node.js-api.html>Node.js API</a></li><li><a href=api-in-modules.html>API in modules</a></li><li><a href=loaders.html>Loaders</a></li><li><a href=plugins.html>Plugins</a></li><li><a href=context.html>Context</a></li><li><a href=resolving.html>Resolving</a></li><li><a href=hot-module-replacement.html>Hot Module Replacement</a></li><li>Dev Tools<ul><li><a href=webpack-dev-server.html>webpack-dev-server</a></li><li><a href=webpack-dev-middleware.html>webpack-dev-middleware</a></li></ul></li></ul></li><li>Development<ul><li><a href=changelog.html>Changelog</a></li><li><a href=roadmap.html>Roadmap</a></li><li><a href=ideas.html>Ideas</a></li><li>Contributing</li></ul></li></ul></div></div><div class=col-md-9><div class=announcement><div class=announcement-inner><em>2014-07-04</em> Help to improve webpack by filling out <a href=https://docs.google.com/forms/d/101ZcujnVL8l575T6VRl62SfrVj5FZC1IzwMH1258GVc/viewform>this little survey</a>. Thanks!</div></div><div class=pull-right><a href=https://github.com/webpack/docs/wiki/hot-module-replacement-with-webpack/_edit id=wikieditlink>Edit</a></div><div class=row><div class="col-md-12 page-header"><h1 id=wikititle>hot module replacement with webpack</h1></div></div><div class=row><div id=wiki class=col-md-12><div class=contents><ul><li><a href=#introduction>Introduction</a><ul><li><a href=#prerequirements>Prerequirements</a></li><li><a href=#how-does-it-work>How does it work?</a><ul><li><a href=#from-the-app-view>From the app view</a></li><li><a href=#from-the-compiler-view>From the compiler view</a></li><li><a href=#from-the-module-view>From the module view</a></li><li><a href=#from-the-hmr-runtime-view>From the HMR runtime view</a></li><li><a href=#generated-files>Generated files</a></li></ul></li><li><a href=#what-can-i-do-with-it>What can I do with it?</a></li><li><a href=#what-is-needed-to-use-it>What is needed to use it?</a></li><li><a href=#what-makes-it-so-cool>What makes it so cool?</a></li><li><a href=#caveats>Caveats</a></li></ul></li><li><a href=#tutorial>Tutorial</a></li></ul></div><p><em>Note that Hot Module Replacement (HMR) is still an experimental feature.</em></p><h1 id=introduction><a class=anchor href=#introduction>&rarr;</a>Introduction</h1><p>Hot Module Replacement (HMR) is a way of exchanging modules in a running application (and adding/removing modules). You basically can update changed modules without a full page reload.</p><h2 id=prerequirements><a class=anchor href=#prerequirements>&rarr;</a>Prerequirements</h2><ul><li>Using Plugins: <a href=http://webpack.github.io/docs/using-plugins.html>http://webpack.github.io/docs/using-plugins.html</a></li><li>Code Splitting: <a href=http://webpack.github.io/docs/code-splitting.html>http://webpack.github.io/docs/code-splitting.html</a></li><li>webpack-dev-server: <a href=http://webpack.github.io/docs/webpack-dev-server.html>http://webpack.github.io/docs/webpack-dev-server.html</a></li></ul><h2 id=how-does-it-work><a class=anchor href=#how-does-it-work>&rarr;</a>How does it work?</h2><h3 id=from-the-app-view><a class=anchor href=#from-the-app-view>&rarr;</a>From the app view</h3><p>The app code asks the HMR runtime to check of updates. The HMR runtime downloads the updates (async) and tell the app code that an update is available. The app code asks the HMR runtime to apply updates. The HMR runtime applies the update (sync). The app code may or may not require user interaction in this process (you decide).</p><h3 id=from-the-compiler-view><a class=anchor href=#from-the-compiler-view>&rarr;</a>From the compiler (webpack) view</h3><p>In addition to the normal assets the compiler need to emit the “Update” to allow updating from previous version to this version. The “Update” contains two parts:</p><ol><li>the update manifest (json)</li><li>one or multiple update chunks (js)</li></ol><p>The manifest contains the new compilation hash and a list of all update chunks (2.).</p><p>The update chunks contains code for all updated modules in this chunk (or a flag if a module was removed).</p><p>The compiler addtionally makes sure that module and chunk ids as consistent between these builds. It uses a “records” json file to store them between builds (on it store them in memory).</p><h3 id=from-the-module-view><a class=anchor href=#from-the-module-view>&rarr;</a>From the module view</h3><p>HMR is a opt-in feature, so it only affects modules that contains HMR code. The documentation describes the API that is available in modules. In general the module developer writes handlers that are called when a dependency of this module is updated. He can also write a handler that are called when this module is updated.</p><p>In most cases it’s not mandatory to write HMR code in every module. If a module has no HMR handlers the update bubbles up. This means a single handler can handle a update to a complete module tree. If a single module in this tree is updated, the complete module tree is reloaded (only reloaded not transferred).</p><h3 id=from-the-hmr-runtime-view><a class=anchor href=#from-the-hmr-runtime-view>&rarr;</a>From the HMR runtime view (technical)</h3><p>For the module system runtime is additional code emitted to track module <code>parents</code> and <code>children</code>.</p><p>On the management side the runtime supports two methods: <code>check</code> and <code>apply</code>.</p><p>A <code>check</code> does a HTTP request to the update manifest. When this request fails, there is no update available. Elsewise the list of updated chunks is compared to the list of currently loaded chunks. For each loaded chunk the corresponding update chunk is downloaded. All module updates as stored in the runtime as update. The runtime switches into the <code>ready</code> state, meaning an update has been downloaded and is ready to be applied.</p><p>For each new chunk request in the ready state the update chunk is also downloaded.</p><p>The <code>apply</code> method flags all updated modules as invalid. For each invalid module there need to be a update handler in the module or update handlers in every parent. Else the invalid buddles up and mark all parents as invalid too. This process continues until no more “bubble up” occurs. If it bubbles up from an entry point the process fails.</p><p>Now all invalid modules are disposed (dispose handler) and unloaded. Then the current hash is updated and all “accept” handlers are called. The runtime switches back to the <code>idle</code> state and everything continues as normal.</p><h3 id=generated-files><a class=anchor href=#generated-files>&rarr;</a>Generated files (technical)</h3><p>The left side represents the inital compiler pass. The right side represents an additional pass with module 4 and 9 updated.</p><p><img src=http://webpack.github.io/assets/HMR.svg alt="generated update chunks"></p><h2 id=what-can-i-do-with-it><a class=anchor href=#what-can-i-do-with-it>&rarr;</a>What can I do with it?</h2><p>You can use it in development as LiveReload replacement. Actually the webpack-dev-server supports a hot mode which try to update with HMR before trying to reload the whole page. You only need to add the <code>webpack/hot/dev-server</code> entry point and call the dev-server with <code>--hot</code>.</p><p>You can also use it in production as update mechanisms. Here you need to write you own management code that integrates HMR with your app.</p><p>Some loaders already generate modules that are hot-updateable. I. e. the <code>style-loader</code> can exchange the stylesheet. You don’t need to do something special.</p><h2 id=what-is-needed-to-use-it><a class=anchor href=#what-is-needed-to-use-it>&rarr;</a>What is needed to use it?</h2><p>A module can only be updated if you “accept” it. So you need to <code>module.hot.accept</code> the module in the parents or the parents of the parents… I. e. a Router is a good place or a subview.</p><p>If you only want to use it with the webpack-dev-server, just add <code>webpack/hot/dev-server</code> as entry point. Else you need some HMR management code that calls <code>check</code> and <code>apply</code>.</p><p>You need to enable records in the Compiler to track module id between processes. (watch mode and the webpack-dev-server keep records in memory, so you don’t need it for development)</p><p>You need to enable HMR in the Compiler to let it add the HMR runtime.</p><h2 id=what-makes-it-so-cool><a class=anchor href=#what-makes-it-so-cool>&rarr;</a>What makes it so cool?</h2><ul><li>It’s LiveReload but for every module kind.</li><li>You can use it in production.</li><li>The updates respect your Code Splitting and only download updates for the used parts of your app.</li><li>You can use in for a part of your application and it doesn’t affect other modules</li><li>If HMR is disabled all HMR code is removed by the compiler (wrap it in <code><span class=keyword>if</span>(module.hot)</code></li></ul><h2 id=caveats><a class=anchor href=#caveats>&rarr;</a>Caveats</h2><ul><li>It’s experimental and not tested so well.</li><li>Expect some bugs</li><li>Theoretically usable in production, but it maybe to early to use it for something serious</li><li>The module ids need to be tracked between compilations so you need to store them (<code>records</code>)</li><li>Optimizer cannot optimize module ids anymore after the first compilation. A bit impact on bundle size.</li><li>HMR runtime code increase bundle size.</li><li>For production usage additional testing is required to test the HMR handlers. This could be pretty difficult.</li></ul><h1 id=tutorial><a class=anchor href=#tutorial>&rarr;</a>Tutorial</h1><p>To use hot code replacement with webpack you need to four things:</p><ul><li>records (<code>--records-path</code>, <code>recordsPath: ...</code>)</li><li>global enable hot code replacement (<code>HotModuleReplacementPlugin</code>)</li><li>hot replacement code in your code <code>module.hot.accept</code></li><li>hot replacement management code in your code <code>module.hot.check</code>, <code>module.hot.apply</code></li></ul><p>A small testcase:</p><pre><code><span class=comment>/* style.css */</span>
<span class=tag>body</span> <span class=rules>{
  <span class=rule><span class=attribute>background</span>:<span class=value> red</span></span>;
<span class=rule>}</span></span></code></pre><pre><code><span class=comment>/* entry.js */</span>
require(<span class=string>"./style.css"</span>);
document.write(<span class=string>"&lt;input type='text' /&gt;"</span>);</code></pre><p>That’s enough to use hot code replacement with the dev-server.</p><pre><code>npm install webpack webpack-dev-server -g
npm install webpack css-loader style-loader
webpack-dev-server webpack/hot/dev-server ./entry --hot --module-bind &quot;css=style!css&quot;</code></pre><p>The dev server provides in memory records, which is good for development.</p><p>There is special management code for the dev-server at <code>webpack/hot/dev-server</code>.</p><p>The <code>style-loader</code> already includes hot replacement code.</p><p>If you visit <a href=http://localhost:8080>http://localhost:8080</a> you should see the page with a red background and a input box. Type some text into the input box and edit <code>style.css</code> to have another background color.</p><p>Voilà… The background updates but without full page refresh. Text and selection in the input box should stay.</p><p>Read more about how to write you own hot replacement (management) code: <a href=hot-module-replacement.html>hot module replacement</a></p><p>Check the <a href="http://webpack.github.io/example-app/">example-app</a> for a demo without coding</p></div></div></div></div></div><a href=https://github.com/webpack/webpack><img style="position: absolute; top: 0; left: 0; border: 0" src=https://s3.amazonaws.com/github/ribbons/forkme_left_orange_ff7600.png alt="Fork me on GitHub"></a>